-- Remove o gatilho que estava causando o erro
		DROP TRIGGER IF EXISTS on_auth_user_created ON auth.users;
		-- Remove todas as funções, incluindo a que dependia do gatilho
		DROP FUNCTION IF EXISTS public.handle_new_user() CASCADE;
		DROP FUNCTION IF EXISTS public.get_dashboard_stats() CASCADE;
		DROP FUNCTION IF EXISTS public.get_faturamento_ultimos_12_meses() CASCADE;
		DROP FUNCTION IF EXISTS public.get_contratos_para_faturar(integer, integer) CASCADE;
		DROP FUNCTION IF EXISTS public.get_visao_cobrancas(p_ano integer, p_mes integer) CASCADE;
		-- Remove todas as views
		DROP VIEW IF EXISTS public.comissoes_view CASCADE;
		DROP VIEW IF EXISTS public.dre_mensal CASCADE;
		DROP VIEW IF EXISTS public.ordens_servico_view CASCADE;
		DROP VIEW IF EXISTS public.produtos_com_estoque CASCADE;
		-- Remove todas as tabelas do schema public
		DO $$
		DECLARE r RECORD;
		BEGIN FOR r IN (
		  SELECT tablename
		  FROM pg_tables
		  WHERE schemaname = 'public'
		) LOOP EXECUTE 'DROP TABLE IF EXISTS public.' || quote_ident(r.tablename) || ' CASCADE';
		END LOOP;
		END $$;
		-- Remove todos os ENUMs (tipos customizados)
		DO $$
		DECLARE r RECORD;
		BEGIN FOR r IN (
		  SELECT t.typname
		  FROM pg_type t
		  JOIN pg_namespace n ON n.oid = t.typnamespace
		  WHERE n.nspname = 'public' AND t.typtype = 'e'
		) LOOP EXECUTE 'DROP TYPE IF EXISTS public.' || quote_ident(r.typname) || ' CASCADE';
		END LOOP;
		END $$;
