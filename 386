/*
          # [Operation Name]
          Recria o tipo 'contribuinte_icms' e insere dados de teste na tabela 'clientes'.

          ## Query Description: [Esta operação irá primeiro apagar e recriar o tipo de dado 'contribuinte_icms' para usar valores simplificados e mais robustos, evitando erros de inserção. Em seguida, ela insere 5 registros de clientes fictícios para permitir testes completos de CRUD (Criar, Ler, Atualizar, Deletar) na interface. Nenhum dado existente será perdido, pois a tabela 'clientes' será preservada.]
          
          ## Metadata:
          - Schema-Category: ["Structural", "Data"]
          - Impact-Level: ["Low"]
          - Requires-Backup: [false]
          - Reversible: [false]
          
          ## Structure Details:
          - Types: 'contribuinte_icms' (recriado)
          - Tables: 'clientes' (dados inseridos)
          
          ## Security Implications:
          - RLS Status: [Enabled]
          - Policy Changes: [No]
          - Auth Requirements: [authenticated]
          
          ## Performance Impact:
          - Indexes: [No]
          - Triggers: [No]
          - Estimated Impact: [Baixo, inserção de poucos registros.]
          */

		-- Remove o tipo antigo para evitar conflitos
		DROP TYPE IF EXISTS public.contribuinte_icms;

		-- Recria o tipo com valores curtos e robustos
		CREATE TYPE public.contribuinte_icms AS ENUM (
		    'CONTRIBUINTE',
		    'CONTRIBUINTE_ISENTO',
		    'NAO_CONTRIBUINTE'
		);

		-- Altera a tabela para usar o novo padrão
		ALTER TABLE public.clientes
		ALTER COLUMN contribuinte_icms SET DEFAULT 'NAO_CONTRIBUINTE'::public.contribuinte_icms;

		-- Inserção de dados de teste
		DO $$
		DECLARE
		    cliente_id_1 UUID;
		    cliente_id_2 UUID;
		    cliente_id_3 UUID;
		    cliente_id_4 UUID;
		    cliente_id_5 UUID;
		BEGIN
		    -- Cliente 1
		    INSERT INTO public.clientes (
		        codigo, nome, tipo_pessoa, cpf_cnpj, rg, contribuinte_icms, is_cliente, is_fornecedor, is_transportadora,
		        logradouro, numero, complemento, bairro, cep, cidade, estado, pais,
		        celular, email, email_nfe, site,
		        estado_civil, profissao, sexo, data_nascimento, naturalidade, status_crm, limite_credito, observacoes
		    ) VALUES (
		        'C001', 'João da Silva', 'FISICA', '123.456.789-01', '12.345.678-9', 'NAO_CONTRIBUINTE', true, false, false,
		        'Rua das Flores', '123', 'Apto 45', 'Jardim Primavera', '12345-678', 'São Paulo', 'SP', 'Brasil',
		        '(11) 98765-4321', 'joao.silva@example.com', 'nfe.joao@example.com', 'https://joaosilva.dev',
		        'Casado(a)', 'Engenheiro de Software', 'Masculino', '1985-05-20', 'São Paulo', 'Cliente', 5000.00, 'Cliente antigo, bom pagador.'
		    ) RETURNING id INTO cliente_id_1;

		    INSERT INTO public.pessoas_contato (cliente_id, nome, setor, email, telefone)
		    VALUES (cliente_id_1, 'Ana Contato', 'Financeiro', 'ana.contato@example.com', '(11) 91234-5678');

		    INSERT INTO public.cliente_anexos (cliente_id, nome_arquivo, path, tamanho, tipo)
		    VALUES (cliente_id_1, 'comprovante.png', 'placeholders/placeholder.png', 1024, 'image/png');

		    -- Cliente 2
		    INSERT INTO public.clientes (
		        codigo, nome, tipo_pessoa, cpf_cnpj, inscricao_estadual, contribuinte_icms, is_cliente, is_fornecedor, is_transportadora,
		        logradouro, numero, bairro, cep, cidade, estado, pais,
		        celular, email, site,
		        status_crm, limite_credito, observacoes
		    ) VALUES (
		        'F002', 'TecnoLogica Ltda', 'JURIDICA', '01.234.567/0001-89', '111.222.333.444', 'CONTRIBUINTE', true, true, false,
		        'Avenida Principal', '1000', 'Centro', '54321-876', 'Rio de Janeiro', 'RJ', 'Brasil',
		        '(21) 99999-8888', 'contato@tecnologica.com', 'https://tecnologica.com',
		        'Prospect', 25000.00, 'Fornecedor de hardware.'
		    ) RETURNING id INTO cliente_id_2;

		    INSERT INTO public.pessoas_contato (cliente_id, nome, setor, email, telefone)
		    VALUES (cliente_id_2, 'Carlos Gerente', 'Compras', 'carlos.compras@tecnologica.com', '(21) 98888-7777');

		    INSERT INTO public.cliente_anexos (cliente_id, nome_arquivo, path, tamanho, tipo)
		    VALUES (cliente_id_2, 'contrato_social.pdf', 'placeholders/placeholder.pdf', 2048, 'application/pdf');

		    -- Cliente 3
		    INSERT INTO public.clientes (
		        nome, tipo_pessoa, cpf_cnpj, contribuinte_icms, is_cliente, is_fornecedor, is_transportadora,
		        logradouro, numero, bairro, cep, cidade, estado, pais,
		        celular, email,
		        status_crm, observacoes
		    ) VALUES (
		        'Maria Oliveira', 'FISICA', '987.654.321-09', 'CONTRIBUINTE_ISENTO', true, false, false,
		        'Travessa dos Sonhos', '42', 'Vila Esperança', '98765-432', 'Belo Horizonte', 'MG', 'Brasil',
		        '(31) 98765-1234', 'maria.oliveira@example.com',
		        'Lead', 'Interessada em serviços de consultoria.'
		    ) RETURNING id INTO cliente_id_3;

		    -- Cliente 4
		    INSERT INTO public.clientes (
		        nome, tipo_pessoa, cpf_cnpj, contribuinte_icms, is_cliente, is_fornecedor, is_transportadora,
		        logradouro, numero, bairro, cep, cidade, estado, pais,
		        celular, email
		    ) VALUES (
		        'Transportes Veloz S.A.', 'JURIDICA', '98.765.432/0001-10', 'CONTRIBUINTE', false, false, true,
		        'Rodovia dos Bandeirantes', 'km 50', 'Distrito Industrial', '13000-000', 'Campinas', 'SP', 'Brasil',
		        '(19) 97777-6666', 'logistica@veloz.com'
		    ) RETURNING id INTO cliente_id_4;

		    -- Cliente 5
		    INSERT INTO public.clientes (
		        nome, tipo_pessoa, cpf_cnpj, contribuinte_icms, is_cliente, is_fornecedor, is_transportadora,
		        logradouro, numero, bairro, cep, cidade, estado, pais,
		        celular, email, limite_credito
		    ) VALUES (
		        'Pedro Martins', 'FISICA', '555.666.777-88', 'NAO_CONTRIBUINTE', true, false, false,
		        'Alameda dos Anjos', '777', 'Paraíso', '45678-123', 'Salvador', 'BA', 'Brasil',
		        '(71) 96543-2109', 'pedro.martins@example.com', 1500.00
		    ) RETURNING id INTO cliente_id_5;
		END $$;
